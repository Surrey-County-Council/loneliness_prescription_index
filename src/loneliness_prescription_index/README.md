# Loneliness - production

A reproducible analytical-ish pipeline for aggregating prescription data relating to loneliness.  This work is being
redone as a reproducible pipeline because a) the source data has changed format, and b) there may be future demand for
this or similar outputs.

## Methodology description
(from blog at https://datasciencecampus.ons.gov.uk/developing-a-loneliness-prescription-index/)

### Aggregating practice data and calculating z-scores - `aggregate_counts.py`

- Takes prescriptions files stored in `data/prescriptions`
- For a specified year, chunks through files to create counts by practice by month output to `working`
- For a specified year, loads and aggregates all monthly counts-by-practice files
- Geocodes the practices using postcode lookup found in `data`
- calculates loneliness scores by practice, saves results and diagnostic histograms to `output`

#### From the blog:
"An index was created for each condition by standardising the proportion of a practices prescriptions that were given for
the condition relative to the levels in other practices (into z scores). The index for each condition had a value that
was negative if prescribing was lower than typical and positive if it was greater than typical. The loneliness index is
generated by summing together these standardised-scores for each condition. The loneliness indicator was verified by
comparison to levels for risk factors; these explained 9% of the variation in the index for different parts of England.
“Living alone” and “barriers to housing and services” each independently drove around 1% of the variation in the
Loneliness Prescription Index."

Main script is at https://github.com/datasciencecampus/loneliness/blob/master/English_presc_data4.py

### Calculating prescriptions at LA and MSOA levels - `estimate_by_LA.py` and `estimate_by_MSOA.py`

- Takes loneliness scores by practice from `output/presc_2020.csv`
- Calculates loneliness scores by LA/MSOA as inverse distance weighted average of loneliness scores of the k-closest
GP's to the centroid of the LA of MSOA (suggest k=5)
- Calculates a LISA (Local Indicator of Spatial Autocorrelation) score for each LA/MSOA to indicate whether that LA/LSOA
is representative of the surrounding areas (ie; has similar scores to them)
- Also Calculates loneliness scores as the mean of all GP's found within an area's boundary, for comparison
- Save scores by LA by both methods in csv files in `output`, plots heat maps for inspection

#### From the blog:
"There are a number of ways to approach the change in support problem, but generally they fall into exact
(simple algorithms) and statistical (probability-based) approaches. As a proof of concept, we used an exact method known
as ‘inverse distance weighting’ to estimate the value of a data point at an unknown location based on the
distance-weighted combination of data values at known points. These estimates are then combined to produce estimates of
loneliness-rated condition prescribing for the UK Census ‘Middle-Layer Super Output Area’ (MSOA) geography."

Main script is at https://github.com/datasciencecampus/loneliness/blob/master/MSOA_ShapePlot.R